<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="本文主要采摘、翻译、修改自 P. Galeone’s blog Analysis of Dropout。
Overfitting is a problem in Deep Neural Networks (DNN): the model learns to classify only the training set, adapting itself to the training examples instead of learning decision boundaries capable of classifying generic instances. Many solutions to the overfitting problem have been presented during these years; one of them have overwhelmed the others due to its simplicity and its empirical good results: Dropout.">
    

    <!--Author-->
    
        <meta name="author" content="Robert Lexis">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Amazing dropout"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="This is Robert Lexis."/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>Amazing dropout - This is Robert Lexis.</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    


</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about">
                    About
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/tags">
                    Tags
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/categories">
                    Categories
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact">
                    Contact
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
    </div>
</header>

        <section class="main">
            
<div class="post">

    <div class="post-header">
        <h1 class="title">
            <a href="/2018/08/05/Amazing-dropout/">
                Amazing dropout
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2018-08-05</span>
            
            
            
        </div>
    </div>

    <div class="content">

        <!-- Gallery -->
        

        <!-- Post Content -->
        <p>本文主要采摘、翻译、修改自 P. Galeone’s blog <a href="https://pgaleone.eu/deep-learning/regularization/2017/01/10/anaysis-of-dropout/" target="_blank" rel="external">Analysis of Dropout</a>。</p>
<p>Overfitting is a problem in Deep Neural Networks (DNN): the model learns to classify only the training set, adapting itself to the training examples instead of learning decision boundaries capable of classifying generic instances. Many solutions to the overfitting problem have been presented during these years; one of them have overwhelmed the others due to its simplicity and its empirical good results: <strong>Dropout</strong>.</p>
<p><img src="/2018/08/05/Amazing-dropout/dropout.jpg" alt="dropout"><br><a id="more"></a><br>Visual representation of Dropout, right from the paper. On the left there’s the network before applying Dropout, on the right the same network with Dropout applied.The network on the left it’s the same network used at test time, once the parameters have been learned.</p>
<p>The idea behind Dropout is to train an ensemble of DNNs and average the results of the whole ensemble instead of train a single DNN.<strong>(Dropout 背后的思想是训练一个含有多个 DNN 的集成学习器。)</strong></p>
<p>The DNNs are built dropping out neurons with \( p \) probability, therefore keeping the others on with probability \( q=1−p \). When a neuron is dropped out, its output is set to zero, no matter what the input or the associated learned parameter is.</p>
<p>The dropped neurons do not contribute to the training phase in both the forward and backward phases of back-propagation: for this reason every time a single neuron is dropped out it’s like the training phase is done on a new network.<strong>(被 dropout 的神经元不参与训练过程的前向传播和反向传播，每次进行一个 batch 的训练的时候，由于被 dropout 的神经元组合不同，就像是在训练一个新的神经网络。)</strong></p>
<p>Quoting the authors:</p>
<blockquote>
<p>In a standard neural network, the derivative received by each parameter tells it how it should change so the final loss function is reduced, given what all other units are doing. Therefore, units may change in a way that they fix up the mistakes of the other units. This may lead to complex co-adaptations. This in turn leads to overfitting because these co-adaptations do not generalize to unseen data. We hypothesize that for each hidden unit, Dropout prevents co-adaptation by making the presence of other hidden units unreliable. <strong>Therefore, a hidden unit cannot rely on other specific units to correct its mistakes.</strong></p>
</blockquote>
<p>In short: Dropout works well in practice because it prevents the co-adaption of neurons during the training phase.</p>
<p>Now that we got an intuitive idea behind Dropout, let’s analyze it in depth.</p>
<h3 id="How-Dropout-works"><a href="#How-Dropout-works" class="headerlink" title="How Dropout works"></a>How Dropout works</h3><p>As said before, Dropout turns off neurons with probability \( p \) and therefore let the others turned on with probability \( q=1−p \)<br><strong> Every single neuron has the same probability of being turned off.</strong> This means that:<br>Given</p>
<ul>
<li>\( h(x) = Wx + b \) a linear projection of a \( d_i \)-dimensional input x into a \( d_h \)-dimensional output space.</li>
<li>\( a(h) \) an activation function<br>it’s possible to model the application of Dropout, in the training phase only, to the given projection as a modified activation function (可以将 Dropout 建模为一个特殊的激活函数（element-wise）):<br>\[<br>f(h) = D \bigodot a(h)<br>\]<br>Where \( D=(X_1, …, X_{d_h}) \) is a \( d_h \)-dimensional vector of Bernoulli variables \( X_i \) （\( d_h \) 维伯努利随机变量的向量）.</li>
</ul>
<h5 id="伯努利随机变量"><a href="#伯努利随机变量" class="headerlink" title="伯努利随机变量"></a>伯努利随机变量</h5><p>A Bernoulli random variable(伯努利随机变量) has the following probability mass distribution（pdf，概率质量函数）:<br>\[<br>f(k; p) = p^k (1-p)^{(1-k)} =<br>\begin{cases}<br>    p \text{ if } k = 1 \\\\<br>    (1-p) \text{ if } k = 0<br>\end{cases}<br>\]<br>Where k are the possible outcomes.</p>
<blockquote>
<p>伯努利分布 Bernoulli distribution，又名两点分布或者0-1分布，是一个离散型概率分布；若伯努利试验成功，则伯努利随机变量取值为1。若伯努利试验失败，则伯努利随机变量取值为0。</p>
</blockquote>
<p><strong> 设 drop rate 为 \( p \)。</strong><br>It’s evident that this random variable perfectly models the Dropout application on a single neuron. In fact, the neuron is turned off with probability \( p = P(X_i = 0) \) and kept on otherwise.<br><strong> 伯努利试验成功的概率是 \( P( X_i = 1) = 1 - p \)。伯努利试验成功，则神经元被保留。伯努利试验失败，则神经元被关闭。</strong></p>
<p>It can be useful to see the application of Dropout on a generic i-th neuron:<br>\[<br>O_i = X_i a(\sum_{k=1}^{d_i} w_k x_k +b) = \begin{cases}<br>a(\sum_{k=1}^{d_i} w_k x_k +b) \text{ if } X_i = 1 \\\\<br>0 \text{ if } X_i = 0<br>\end{cases}<br>\]<br>where \( P(X_i = 0) = p \) （即 \(X_i \thicksim Bernoulli(1-p) \)，\( X_i \) 服从成功概率为 \( (1-p) \) 的伯努利分布。）</p>
<p>Since during train phase a neuron is kept on with probability \( q \), during the testing phase we have to emulate the behavior of the ensemble of networks used in the training phase.</p>
<p>To do this, the authors suggest <strong> scaling the activation function by a factor of \( q \) </strong> during the test phase in order to use the expected output produced in the training phase as the single output required in the test phase. Thus:</p>
<p>Train phase:<br>\[<br>O_i = X_i a(\sum_{k=1}^{d_i} w_k x_k + b)<br>\]<br>Test phase:<br>\[<br>O_i= q a(\sum_{k=1}^{d_i} w_k x_k + b)<br>\]</p>
<blockquote>
<p>其实可以看到当 \( X_i \thicksim Bernoulli(1-p) \) 即 \( P(X_i = 0) = p \) 时，\( E(X_i) = (1-p) = q \)。</p>
</blockquote>
<h3 id="Inverted-Dropout"><a href="#Inverted-Dropout" class="headerlink" title="Inverted Dropout"></a>Inverted Dropout</h3><p>A slightly different approach is to use Inverted Dropout. This approach consists in the scaling of the activations during the training phase, leaving the test phase untouched.</p>
<p>The scale factor is the inverse of the keep probability: \( \frac{1}{1-p} = \frac{1}{q} \), thus:<br>Train phase:<br>\[<br>O_i = \frac{1}{q} X_i a(\sum_{k=1}^{di} w_k x_k + b)<br>\]<br>Test phase:<br>\[<br>O_i = a(\sum_{k=1}^{d_i} w_k x_k + b)<br>\]</p>
<p><strong>Inverted Dropout is how Dropout is implemented in practice in the various deep learning frameworks</strong> because it helps to define the model once and just change a parameter (the keep/drop probability) to run train and test on the same model.</p>
<p>Direct Dropout, instead, force you to modify the network during the test phase because if you don’t multiply by \( q \) the output the neuron will produce values that are higher respect to the one expected by the successive neurons (thus the following neurons can saturate or explode): that’s why Inverted Dropout is the more common implementation.</p>
<h3 id="Dropout-of-a-set-of-neurons"><a href="#Dropout-of-a-set-of-neurons" class="headerlink" title="Dropout of a set of neurons"></a>Dropout of a set of neurons</h3><p><strong> 设 drop rate 为 \( p \)。</strong><br>It can be easily noticed that a layer \( h \) with \( n \)  neurons, in a single train step, can be seen as an ensemble of \( n \) Bernoulli experiments, each one with a probability of success equals to \( 1 - p \). (可以看成是 \( n \) 次成功概率为 \( 1 - p \) 伯努利试验)。<br>Thus, the output of the layer h have a number of dropped neurons equals to (被关闭的神经元的数目为):<br>\[<br>Y = \sum_{k=1}^{d_h} 1 - X_i<br>\]</p>
<p>Since every neuron is now modeled as a Bernoulli random variable and all these random variables are independent and identically distributed, the total number of dropped neuron is a random variable too, called Binomial(二项分布):<br>\[<br>Y \thicksim Bi(d_h, p)<br>\]<br>Where the probability of getting exactly k shutdown neurons in n is given by the probability mass distribution:<br>\[<br>f(k;n, p) = \left( \begin{matrix} k \\\ n \end{matrix} \right) p^k (1-p)^{(n-k)}<br>\]</p>
<p>We can now use this distribution to analyze the probability of dropping a specified number of neurons.<br>When using Dropout, we define a fixed Dropout probability \( p \) for a chosen layer and we expect that a proportional number of neurons are dropped from it.<br>For example, if the layer we apply Dropout to has \( n=1024 \) neurons and \( p=0.5 \), we expect that 512 get dropped. Let’s verify this statement:<br>\[<br>Y = \sum_{i=1}^{1024} X_i \\\\<br>Y \thicksim Bi(1024, 0.5) \\\\<br>P(Y=512) = \left( \begin{matrix} 512 \\\ 1024 \end{matrix} \right) 0.5^{512} \times (1−0.5)^{(1024−512)} \approx 0.025<br>\]<br>Thus, the probability of dropping out exactly \( np=512 \) neurons is of only 0.025!</p>
<p>A python 3 script can help us to visualize how neurons are dropped for different values of p and a fixed value of n. The code is commented.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"><span class="keyword">from</span> scipy.stats <span class="keyword">import</span> binom</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"></div><div class="line"><span class="comment"># number of neurons</span></div><div class="line">n = <span class="number">1024</span></div><div class="line"><span class="comment"># number of tests (input examples)</span></div><div class="line">size = <span class="number">500</span></div><div class="line"><span class="comment"># histogram bin width, for data visualization</span></div><div class="line">binwidth = <span class="number">5</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> p <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">10</span>):</div><div class="line">    <span class="comment"># per layer probability</span></div><div class="line">    prob = p / <span class="number">10</span></div><div class="line">    <span class="comment"># generate size values from a bi(n, prob)</span></div><div class="line">    rnd_values = binom.rvs(n, prob, size=size)</div><div class="line">    <span class="comment"># draw histogram of rnd values</span></div><div class="line">    plt.hist(</div><div class="line">        rnd_values,</div><div class="line">        bins=[x <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>, n, binwidth)],</div><div class="line">        <span class="comment"># normalize = extract the probabilities</span></div><div class="line">        normed=<span class="number">1</span>,</div><div class="line">        <span class="comment"># pick a random color</span></div><div class="line">        color=np.random.rand(<span class="number">3</span>, <span class="number">1</span>),</div><div class="line">        <span class="comment"># label the histogram with its probability</span></div><div class="line">        label=str(prob))</div><div class="line"></div><div class="line">plt.legend(loc=<span class="string">'upper right'</span>)</div><div class="line">plt.show()</div></pre></td></tr></table></figure></p>
<p>The binomial distribution is very peaked around \( np \). As we can see from the image above no matter what the p value is, the number of neurons dropped on average is proportional to \( np \), in fact:<br>\[<br>E[Bi(n,p)]=np<br>\]<br><img src="/2018/08/05/Amazing-dropout/distributions.png" alt="distributions"><br>Moreover, we can notice that the distribution of values is almost symmetric around \( p=0.5 \) and the probability of dropping \( np \) neurons increase as the distance from \( p=0.5 \) increase.</p>
<p>The scaling factor has been added by the authors to compensate(补偿) the activation values, because they expect that during the training phase only a percentage of \( 1−p \) neurons have been kept. During the testing phase, instead, the 100% of neurons are kept on, thus the value should be scaled down accordingly.</p>
<h3 id="Dropout-amp-other-regularizers"><a href="#Dropout-amp-other-regularizers" class="headerlink" title="Dropout &amp; other regularizers"></a>Dropout &amp; other regularizers</h3><p>Dropout is often used with <strong>L2 normalization</strong> and other parameter constraint techniques (such as Max Norm), this is not a case. Normalizations help to keep model parameters value low, in this way a parameter can’t grow too much.（将权重参数保持在较小的数值。）</p>
<p>In brief, the L2 normalization (for example) is an additional term to the loss, where \( \lambda \in [0, 1] \) is an hyper-parameter called regularization strength, \( F(W;x) \) is the model and \( \varepsilon \) is the error function between the real \( y \) and the predicted \( \tilde{y} \).<br>\[<br>\mathcal{L} = \varepsilon(y, F(W;x)) + \frac{\lambda}{2} W^2<br>\]<br>It’s easy to understand that this additional term, when doing back-propagation via gradient descent, reduces the update amount (使得更新不会正的太大). If \( \eta \) is the learning rate, the update amount of the parameter \(w \in W\) is<br>\[<br>w \gets w − \eta (\frac{\partial F(W;x) }{\partial w} + \lambda w)<br>\]<br>Dropout alone, instead, does not have any way to prevent parameter values from becoming too large during this update phase. <strong>Moreover, the inverted implementation leads the update steps to become bigger, as showed below.</strong></p>
<h5 id="Inverted-Dropout-and-other-regularizers"><a href="#Inverted-Dropout-and-other-regularizers" class="headerlink" title="Inverted Dropout and other regularizers"></a>Inverted Dropout and other regularizers</h5><p>Since Dropout does not prevent parameters from growing and overwhelming each other, applying L2 regularization (or any other regularization technique that constraints the parameter values) can help.</p>
<p>Making explicit the scaling factor, the previous equation becomes:<br>\[<br>w \gets w − \eta (\frac{1}{q} \frac{\partial F(W;x) }{\partial w} + \lambda w)<br>\]<br>It can be easily seen that when using Inverted Dropout, the learning rate is scaled by a factor of q. q has values in [0,1].For this reason, from now on we’ll call \( q \) boosting factor because it boosts the learning rate. Moreover, we’ll call \( \frac{\eta}{q} \) the effective learning rate.</p>
<p>The effective learning rate, thus, is higher respect to the learning rate chosen: for this reason normalizations that constrain the parameter values can help to simplify the learning rate selection process.</p>
<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><ul>
<li>Dropout exists in two versions: direct (not commonly implemented) and inverted</li>
<li>Dropout on a single neuron can be modeled using a <strong>Bernoulli</strong> random variable</li>
<li>Dropout on a set of neurons can be modeled using a <strong>Binomial</strong> random variable</li>
<li>Even if the probability of dropping exactly \( np \) neurons is low, \( np \) neurons are dropped on average on a layer of \( n \) neurons.</li>
<li>Inverted Dropout boost the learning rate</li>
<li>Inverted Dropout should be using together with other normalization techniques that constrain the parameter values in order to simplify the learning rate selection procedure</li>
<li>Dropout helps to prevent overfitting in deep neural networks.</li>
<li>Max Norm impose a constraint to the parameters size. Chosen a value for the hyper-parameter \( c \). It imposes the constraint \( |w| \leq c \).<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script></li>
</ul>

    </div>

    

    
        <div class="post-tags">
            <i class="fa fa-tags" aria-hidden="true"></i>
            <a href="/tags/DL/">#DL</a>
        </div>
    

    <!-- Comments -->
    

</div>
        </section>

    </div>
</div>


</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    This is Robert Lexis (FengCun Li). To see the world, things dangerous to come to, to see behind walls, to draw closer, to find each other and to feel. That is the purpose of LIFE.
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2019/03/14/Perfect-forward/">Perfect forward</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2019/03/14/Move-semantic-perfect-forward/">Move semantic &amp; perfect f</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2019/03/14/RAII-smart-pointer/">RAII &amp; smart pointer</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2019/03/13/Leetcode/">Leetcode</a>
            </li>
            
        </ul>
    </div>



            
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a href="https://github.com/RobertLexis">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:robert_lexis@163.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    @Untitled. All right reserved | Robert Lexis Loves Wenny
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML'></script>

<!-- Custom JavaScript -->
<script src="/js/main.js"></script>

<!-- Disqus Comments -->



</body>

</html>