<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="Ubuntu + 2*1080Ti 深度学习环境配置配置及环境


配件
型号
数量




机箱
美商海盗船 AIR740 中塔机箱
1


电源
美商海盗船 HX1000 80plus 1000W
1


主板
华硕（ASUS） X99-M WS (Intel X99/LGA 2011-V3)
1


CPU
英特尔 至强 E5-2620
1


散热
猫头鹰NH-U9S CPU散热器
1


硬盘
西部数据 红盘 3T
2


SSD
英特尔 600P 256G M.2
1


内存
美商海盗船 DDR4 3000 16G
2


GPU
技嘉 AORUS GTX 1080Ti Xtreme Edition
2







版本




Ubuntu
16.04.1


Nvidia driver
384.98">
    

    <!--Author-->
    
        <meta name="author" content="Robert Lexis">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Ubuntu + 2*1080Ti 深度学习环境配置"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="This is Robert Lexis."/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>Ubuntu + 2*1080Ti 深度学习环境配置 - This is Robert Lexis.</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    


</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about">
                    About
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/tags">
                    Tags
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/categories">
                    Categories
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact">
                    Contact
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
    </div>
</header>

        <section class="main">
            
<div class="post">

    <div class="post-header">
        <h1 class="title">
            <a href="/2017/11/13/Ubuntu-2-1080Ti-深度学习环境配置/">
                Ubuntu + 2*1080Ti 深度学习环境配置
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-11-13</span>
            
            
            
        </div>
    </div>

    <div class="content">

        <!-- Gallery -->
        

        <!-- Post Content -->
        <h2 id="Ubuntu-2-1080Ti-深度学习环境配置"><a href="#Ubuntu-2-1080Ti-深度学习环境配置" class="headerlink" title="Ubuntu + 2*1080Ti 深度学习环境配置"></a>Ubuntu + 2*1080Ti 深度学习环境配置</h2><h3 id="配置及环境"><a href="#配置及环境" class="headerlink" title="配置及环境"></a>配置及环境</h3><table>
<thead>
<tr>
<th>配件</th>
<th>型号</th>
<th>数量</th>
</tr>
</thead>
<tbody>
<tr>
<td>机箱</td>
<td>美商海盗船 AIR740 中塔机箱</td>
<td>1</td>
</tr>
<tr>
<td>电源</td>
<td>美商海盗船 HX1000 80plus 1000W</td>
<td>1</td>
</tr>
<tr>
<td>主板</td>
<td>华硕（ASUS） X99-M WS (Intel X99/LGA 2011-V3)</td>
<td>1</td>
</tr>
<tr>
<td>CPU</td>
<td>英特尔 至强 E5-2620</td>
<td>1</td>
</tr>
<tr>
<td>散热</td>
<td>猫头鹰NH-U9S CPU散热器</td>
<td>1</td>
</tr>
<tr>
<td>硬盘</td>
<td>西部数据 红盘 3T</td>
<td>2</td>
</tr>
<tr>
<td>SSD</td>
<td>英特尔 600P 256G M.2</td>
<td>1</td>
</tr>
<tr>
<td>内存</td>
<td>美商海盗船 DDR4 3000 16G</td>
<td>2</td>
</tr>
<tr>
<td>GPU</td>
<td>技嘉 AORUS GTX 1080Ti Xtreme Edition</td>
<td>2</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th></th>
<th>版本</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ubuntu</td>
<td>16.04.1</td>
</tr>
<tr>
<td>Nvidia driver</td>
<td>384.98</td>
</tr>
</tbody>
</table>
<a id="more"></a>
<h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><ol>
<li><p>禁用 UEFI Secure Boot，不同的主板有不同的方法。Rod Smith 在 <a href="http://www.rodsbooks.com/efi-bootloaders/secureboot.html#disable" target="_blank" rel="external">Managing EFI Boot Loaders for Linux: Dealing with Secure Boot</a> 中描述的很细致。如果不禁用的话，会出现：</p>
<ol>
<li>驱动安装成功后并不会被成功地启动。<code>nvidia-smi</code>并不能成功地查看到 GPU 的信息。而是会报出 <code>NVIDIA-SMI has failed because it couldn&#39;t communicate with the NVIDIA driver. Make sure that the latest NVIDIA driver is installed and running.</code> 的错误。</li>
<li><p>开机后，在图形登录界面即使密码正确，也不能成功地登录（仍可以通过终端成功地登陆），而是不断地循环在输入密码、再次要求输入密码之间。</p>
<blockquote>
<p>Unified Extensible Firmware Interface<br>The Unified Extensible Firmware Interface (UEFI) is a specification(规格, 标准) that defines a software interface between an operating system and platform firmware. UEFI replaces the Basic Input/Output System (BIOS) firmware interface originally present in all IBM PC-compatible personal computers, with most UEFI firmware implementations providing legacy support for BIOS services. UEFI can support remote diagnostics and repair of computers, even with no operating system installed. The user can enter a setup utility by pressing their manufacturers specific setup keys. Most common keys are Delete,F2, F12,esc etc.</p>
</blockquote>
</li>
</ol>
</li>
<li><p>关闭 X server。由于我是使用 Xshell 通过 ssh 登陆的，因此此处我就直接通过 <code>service lightdm stop</code> 关闭了图形界面，此时可以看到远端机器的屏幕黑屏了。这里命令需要根据具体的图形桌面是kdm，gdm，还是 lightdm 而定。<br>如果不关闭X server 就会报出 <code>You appear to be running an X server; please exit X before installing.</code>。</p>
<blockquote>
<p>X server 是 Linux 系统里图形接口服务器的简称。Windows 系统的界面是其系统构成不可分割的一部分，各种窗口操作的界面显示都是由系统核心直接管理的，而 Linux 的图形界面并不是系统的必要组成部分，Linux 可以在无界面的条件下运行。当需要 Linux 提供界面的时候，系统就会建立一个或者数个 X server，通过 X 协议跟窗口管理器交互，由独立于系统的应用程序来产生窗口，状态栏，按钮之类的交互界面。</p>
<p>比较常见的 Linux 图形界面操作环境有 KDE 和 GNOME，为它们提供系统支持的就是 X server，而并非 Linux 核心。总结一下 Linux 图形界面层次关系：Linux本身–&gt;X服务器&lt;-[通过X协议交谈]-窗口管理器–&gt;X应用程序。</p>
</blockquote>
</li>
</ol>
<h3 id="安装显卡驱动"><a href="#安装显卡驱动" class="headerlink" title="安装显卡驱动"></a>安装显卡驱动</h3><ol>
<li>到英伟达<a href="http://www.nvidia.cn/Download/index.aspx?lang=cn" target="_blank" rel="external">驱动程序下载官网</a>下载对应于显卡型号的驱动。</li>
<li><p>安装</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chmod a+x NVIDIA-Linux-x86_64-384.98.run</div><div class="line">./NVIDIA-Linux-x86_64-384.98.run</div></pre></td></tr></table></figure>
<p> 安装过程中会询问是否通过 x-config 屏蔽开源驱动 nouveau，选择接受通过 x-config 进行备份，这样安装失败时，通过 <code>./NVIDIA-Linux-x86_64-384.98.run --uninstall</code> 卸载驱动，恢复使用 nouveau 就仍然可以使用图形界面。</p>
</li>
<li><code>nvidia-smi</code>查看显卡信息。<br> <img src="http://oytnj8g2y.bkt.clouddn.com/nvidia_smi.png" alt="显卡信息"></li>
</ol>
<h3 id="安装CUDA"><a href="#安装CUDA" class="headerlink" title="安装CUDA"></a>安装CUDA</h3><ol>
<li>按照 <a href="http://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html" target="_blank" rel="external">CUDA TOOLKIT DOCUMENTATION</a> 给出的步骤进行 Pre-installation Actions，Package Manager Installation，Post-installation Actions 安装。</li>
<li>到英伟达<a href="https://developer.nvidia.com/cuda-downloads" target="_blank" rel="external">CUDA Toolkit Download 官网</a>下载对应操作系统的 CUDA 。</li>
<li>如果安装失败，需要重新尝试时通过 <code>sudo apt-get --purge remove cuda</code> 对 CUDA 进行卸载。</li>
<li>最新版的 CUDA 是 9.0，但是 TensorFlow 目前并不支持 9.0，只好从 <a href="https://developer.nvidia.com/cuda-80-download-archive" target="_blank" rel="external">Legacy Releases</a> 下载 CUDA 8.0。</li>
</ol>
<h3 id="安装CUDNN"><a href="#安装CUDNN" class="headerlink" title="安装CUDNN"></a>安装CUDNN</h3><ol>
<li>按照 <a href="http://docs.nvidia.com/deeplearning/sdk/cudnn-install/index.html" target="_blank" rel="external">DEEP LEARNING DOCUMENTATION</a> 给出的步骤进行。</li>
</ol>
<h3 id="安装tensorflow"><a href="#安装tensorflow" class="headerlink" title="安装tensorflow"></a>安装tensorflow</h3><ol>
<li><code>sudo apt-get install libcupti-dev</code></li>
<li><code>pip install tensorflow-gpu</code> 但是由于 tensorflow 目前只支持 3.5，所以会报出运行时和编译时 Python 版本不匹配的问题。</li>
<li>改用 Installing with Anaconda： <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">conda create -n tensorflow python=3.5</div><div class="line">source activate tensorflow</div><div class="line">pip install tensorflow</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="挂载磁盘"><a href="#挂载磁盘" class="headerlink" title="挂载磁盘"></a>挂载磁盘</h3><ol>
<li>查看一下磁盘信息 <code>sudo lshw -C disk</code></li>
<li>格式化磁盘，将磁盘格式化为 ext3 格式 <code>sudo mke2fs -j /dev/hdd1</code></li>
<li>查看一下分区类型 <code>sudo blkid</code></li>
<li><p>设置启动自动挂载磁盘</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo vim /etc/fstab</div><div class="line">/dev/sda /home/shark/Codes ext3 defaults 0 0</div><div class="line">/dev/sdb /home/wjx/Codes ext3 defaults 0 0</div></pre></td></tr></table></figure>
</li>
<li><p><code>sudo reboot</code></p>
</li>
</ol>
<h3 id="监视NVIDIA的GPU"><a href="#监视NVIDIA的GPU" class="headerlink" title="监视NVIDIA的GPU"></a>监视NVIDIA的GPU</h3><ol>
<li><code>watch -n 1 nvidia-smi</code><blockquote>
<p>whatis watch<br>watch (1) - execute a program periodically, showing output fullscreen</p>
</blockquote>
</li>
</ol>
<h3 id="新增一个用户，将其家目录链接到硬盘挂载点下的一个目录上"><a href="#新增一个用户，将其家目录链接到硬盘挂载点下的一个目录上" class="headerlink" title="新增一个用户，将其家目录链接到硬盘挂载点下的一个目录上"></a>新增一个用户，将其家目录链接到硬盘挂载点下的一个目录上</h3><p>之前一直是我和师弟一人一个 1T 的硬盘，为了给同学新建一个用户，且为其分配足够的空间，需要将其家目录链接到硬盘挂载点下的一个目录上。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">sudo useradd -d /home/hz -m -s /bin/bash hz</div><div class="line">mkdir /home/wjx/Codes/HZ</div><div class="line">sudo chown -R hz:hz HZ/</div><div class="line">ln -s /home/hz /home/wjx/Codes/HZ/</div></pre></td></tr></table></figure></p>
<p>验证链接成功：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">ls /home/wjx/Codes/HZ/hz</div><div class="line">examples.desktop</div><div class="line">ls /home/hz/</div><div class="line">examples.desktop</div><div class="line">ll /home/hz/</div><div class="line">总用量 32</div><div class="line">drwxr-xr-x 2 hz   hz   4096 11月 29 20:08 ./</div><div class="line">drwxr-xr-x 5 root root 4096 11月 29 20:08 ../</div><div class="line">-rw-r--r-- 1 hz   hz    220 9月   1  2015 .bash_logout</div><div class="line">-rw-r--r-- 1 hz   hz   3771 9月   1  2015 .bashrc</div><div class="line">-rw-r--r-- 1 hz   hz   8980 4月  20  2016 examples.desktop</div><div class="line">-rw-r--r-- 1 hz   hz    655 6月  24  2016 .profile</div><div class="line">ll /home/wjx/Codes/HZ/hz</div><div class="line">lrwxrwxrwx 1 root root 8 11月 29 20:11 /home/wjx/Codes/HZ/hz -&gt; /home/hz/</div></pre></td></tr></table></figure></p>
<blockquote>
<p><strong>软链接与硬链接的区别：</strong></p>
<ol>
<li>对于一个文件来说，有唯一的索引节点与之对应，而对于一个索引节点号，却可以有多个文件名与之对应。因此，在磁盘上的同一个文件可以通过不同的路径去访问。注意在Linux下是一切皆文件。<br>链接有软链接和硬链接(hard link)之分的，软链接(symbolic link)又叫符号链接。符号链接相当于 Windows下的快捷方式。<br><code>ln -s source dist</code>        # 建立软链接<br><code>ln -s /mnt/hgfs/ /home/luo/</code>    # 注意后面的 “/”，是将目录里所有的文件链接过去，必须加上，否则，建立的目录显示颜色异常，不能正常访问，比如 cd 进不去<br><code>ln source dist</code>           # 建立硬链接</li>
<li>软链接实际上只是一段文字，里面包含着它所指向的文件的名字，系统看到软链接后自动跳到对应的文件位置处进行处理；相反，硬链接为文件开设一个新的目录项，硬链接与文件原有的名字是平权的，在Linux看来它们是等价的。由于这个原因，硬链接不能链接两个不同文件系统上的文件。<br>软链接可以跨文件系统 ，硬链接不可以。</li>
<li>关于 I 节点的问题 。硬链接不管有多少个，都指向的是同一个 I 节点，会把节点链接数增加，只要节点的链接数不是 0，文件就一直存在，不管你删除的是源文件还是链接的文件 。只要有一个存在 ，文件就存在 （其实也不分什么源文件,链接文件的 ，因为他们指向都是同一个 I 节点）。当你修改源文件或者链接文件任何一个的时候 ，其他的文件都会做同步的修改。<br>软链接不直接使用 I 节点号作为文件指针,而是使用文件路径名作为指针。所以删除链接文件 对源文件无影响，但是删除源文件，链接文件就会找不到要指向的文件。软链接有自己的 I 节点,并在磁盘上有一小片空间存放路径名。</li>
<li>I 节点 :它是UNIX内部用于描述文件特性的数据结构。我们通常称 I 节点为文件索引节点(信息节点)。I 节点含有关于文件的大部分的重要信息,包括文件数据块在磁盘上的地址.每一个 I 节点有它自己的标志号,我们称为文件顺序号。I 节点包含的信息 1.文件类型 2.文件属主关系 3.文件的访问权限 4.文件的时间截。</li>
</ol>
</blockquote>
<h3 id="安装CUDA-9-0"><a href="#安装CUDA-9-0" class="headerlink" title="安装CUDA 9.0"></a>安装CUDA 9.0</h3><p>tensorflow 1.4 使用的 cuda 8.0，在更新至 1.8 之后，tensorflow 1.8 使用的是 cuda 9.0，因此有必要进行 cuda 的更新。</p>
<ol>
<li><code>sudo apt-get --purge remove cuda</code><br>An incomplete installation of libglvnd was found. Do you want to install a</li>
</ol>
<p>full copy of libglvnd? This will overwrite any existing libglvnd libraries.</p>
<p>(Answer: Abort installation.)<br>To uninstall the CUDA Toolkit, run the uninstall script in /usr/local/cuda-9.0/bin<br>To uninstall the NVIDIA Driver, run nvidia-uninstall</p>
<p>Please see CUDA_Installation_Guide_Linux.pdf in /usr/local/cuda-9.0/doc/pdf for detailed information on setting up CUDA.<br>sudo /usr/local/cuda-9.0/bin/uninstall_cuda_9.0.pl </p>

    </div>

    

    

    <!-- Comments -->
    

</div>
        </section>

    </div>
</div>


</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    This is Robert Lexis (FengCun Li). To see the world, things dangerous to come to, to see behind walls, to draw closer, to find each other and to feel. That is the purpose of LIFE.
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2019/04/23/Iterator-invalidation-rules/">Iterator invalidation rul</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2019/03/18/Emplace-back/">Emplace back</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2019/03/14/Perfect-forward/">Perfect forward</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2019/03/14/Move-semantic-perfect-forward/">Move semantic &amp; perfect f</a>
            </li>
            
        </ul>
    </div>



            
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a href="https://github.com/RobertLexis">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:robert_lexis@163.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    @Untitled. All right reserved | Robert Lexis Loves Wenny
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML'></script>

<!-- Custom JavaScript -->
<script src="/js/main.js"></script>

<!-- Disqus Comments -->



</body>

</html>