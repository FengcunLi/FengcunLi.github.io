<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="SimPy 基础">
<meta property="og:type" content="article">
<meta property="og:title" content="Learning Simpy">
<meta property="og:url" content="http://yoursite.com/2017/11/16/Learning-Simpy/index.html">
<meta property="og:site_name" content="The next stop - Antarctica">
<meta property="og:description" content="SimPy 基础">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-11-09T04:31:36.845Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Learning Simpy">
<meta name="twitter:description" content="SimPy 基础">

<link rel="canonical" href="http://yoursite.com/2017/11/16/Learning-Simpy/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Learning Simpy | The next stop - Antarctica</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">The next stop - Antarctica</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">To see behind walls. To draw closer.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/16/Learning-Simpy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Fengcun Li">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="The next stop - Antarctica">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Learning Simpy
        </h1>

        <div class="post-meta">
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-09 12:31:36" itemprop="dateModified" datetime="2020-11-09T12:31:36+08:00">2020-11-09</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="SimPy-基础"><a href="#SimPy-基础" class="headerlink" title="SimPy 基础"></a>SimPy 基础</h3><a id="more"></a>
<h4 id="How-SimPy-works"><a href="#How-SimPy-works" class="headerlink" title="How SimPy works"></a>How SimPy works</h4><p>SimPy 就是一个异步事件调度器，使用者要做的就是生成事件并指定事件在什么情况下触发及调度。<br><strong>事件</strong>按照优先级和仿真时间排序，拥有递增的事件 id。一个事件有一个回调列表，这些回调会在事件触发时被执行。事件可以有返回值。<br>另一个概念就是<strong>进程函数</strong>，进程函数就是一个 <code>yield</code> 出 <code>Event</code> 实例的 Python 生成器函数。<br><strong>环境</strong>将事件存储在事件列表中，并 keeps track of 当前的仿真时间。<br>关键流程：当一个进程函数 yield 出一个事件时，SimPy 会将进程函数加入事件的回调列表，并挂起进程函数直到事件触发。当等待事件触发的进程函数恢复执行时就会得到事件的返回值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> simpy</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">example</span><span class="params">(env)</span>:</span></span><br><span class="line">    event = simpy.events.Timeout(env, delay=<span class="number">1</span>, value=<span class="number">42</span>)</span><br><span class="line">    value = <span class="keyword">yield</span> event</span><br><span class="line">    print(<span class="string">'now=%d, value=%d'</span> % (env.now, value))</span><br><span class="line"></span><br><span class="line">env = simpy.Environment()</span><br><span class="line">example_gen = example(env)</span><br><span class="line">p = simpy.events.Process(env, example_gen)</span><br><span class="line">env.run()</span><br><span class="line"></span><br><span class="line">now=<span class="number">1</span>, value=<span class="number">42</span></span><br></pre></td></tr></table></figure>
<p>The <code>example()</code> process function above first creates a <code>Timeout</code> event. It passes the environment, a delay, and a value to it. The Timeout schedules itself at <code>now + delay</code> (that’s why the environment is required); other event types usually schedule themselves at the current simulation time.<br>（<code>Timeout</code> 事件，超时事件，这个事件的调度时间是 <code>env.now + delay</code>， 也就是在 <code>env._queue</code> 中的时间标签是 <code>env.now + delay</code>，因此会 <code>env.now + delay</code> 时出队并调用其回调。其他类型的事件通常的调度时间是 current simulation time <code>env.now</code>，即在 <code>env._queue</code> 中的时间标签就是那时的<code>env.now</code>，在 <code>env._queue</code> 中的时间标签和触发时间有关，也就是被触发加入 <code>env._queue</code> 时的 <code>env.now</code>。）<br>Starting a process function involves two things:</p>
<ol>
<li>You have to call the process function to create a generator object（在 JS 的忍者秘术中将其称之为生成器迭代器）. (This will not execute any code of that function yet.)</li>
<li>进程的实例化会触发一个 <code>Initialize</code> 事件，并将其加入事件队列，这个事件的调度时间是 <code>current simulation time</code>，即其在 <code>env._queue</code> 中的时间标签就是那时的 <code>env.now</code>。进程也是一个事件，会在进程函数返回时触发并加入事件队列，这个事件的调度时间也是 <code>current simulation time</code>，即其在 <code>env._queue</code> 中的时间标签就是那时的 <code>env.now</code>。<br>“Best practice” version of the example above</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> simpy</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">example</span><span class="params">(env)</span>:</span></span><br><span class="line">    value = <span class="keyword">yield</span> env.timeout(<span class="number">1</span>, value=<span class="number">42</span>)</span><br><span class="line">    print(<span class="string">'now=%d, value=%d'</span> % (env.now, value))</span><br><span class="line"></span><br><span class="line">env = simpy.Environment()</span><br><span class="line">p = env.process(example(env))</span><br><span class="line">env.run()</span><br></pre></td></tr></table></figure>
<h4 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h4><ol>
<li><p>仿真控制<br>SimPy 的仿真控制十分的灵活，可以运行仿真直到事件列表为空、直到某个仿真时间、直到某个事件触发，也可以逐个事件运行仿真。</p>
<p><code>env.run()</code> 会运行仿真直到事件列表为空。</p>
<blockquote>
<p>If your processes run forever (<code>while True: yield env.timeout(1)</code>), this method will never terminate (unless you kill your script by e.g., pressing <code>Ctrl-C</code>).</p>
</blockquote>
<p><code>env.run(until=10)</code> 仿真会在内部时钟到达 10 时停止，但是不会处理 time 10 的事件。<br>If you want to integrate your simulation in a GUI and want to draw a process bar, you can repeatedly call this function with increasing until values and update your progress bar after each call:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for i in range(100):</span><br><span class="line">    env.run(until=i)</span><br><span class="line">    progressbar.update(i)</span><br></pre></td></tr></table></figure>
<p><code>env.run(event)</code> or <code>env.run(process)</code> 会运行仿真直到事件触发（进程函数返回）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import simpy</span><br><span class="line">def my_proc(env):</span><br><span class="line">    yield env.timeout(1)</span><br><span class="line">    return &apos;Monty Python’s Flying Circus&apos;</span><br><span class="line">env = simpy.Environment()</span><br><span class="line">proc = env.process(my_proc(env))</span><br><span class="line">print(env.run(until=proc))</span><br></pre></td></tr></table></figure>
<p><code>peek()</code> returns the time of the next scheduled event or infinity (<code>float(&#39;inf&#39;)</code>) if no future events are scheduled.</p>
<p><code>step()</code> processes the next scheduled event. It raises an <code>EmptySchedule</code> exception if no event is available.</p>
<p>In a typical use case, you use these methods in a loop like:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">until = 10</span><br><span class="line">while env.peek() &lt; until:</span><br><span class="line">   env.step()</span><br></pre></td></tr></table></figure>
</li>
<li><p>状态访问<br><code>Environment.now</code> 可以获得仿真时间，仿真时间是没有单位的，并且只会通过 <code>Timeout</code> 事件增加。<br><code>Environment.active_process</code> is comparable to <code>os.getpid()</code> and is either <code>None</code> or pointing at the currently active <code>Process</code>. A process is active when its process function is being executed. <strong>It becomes inactive (or suspended) when it yields an event.</strong><br>Thus, it only makes sense to access this property from within a process function or a function that is called by your process function:<br>如果不是这样的话，在进程函数外（即执行流在进程函数外）时，访问到的<code>Environment.active_process</code>肯定是 <code>None</code>。被进程函数调用的函数可以通过这个属性获得调用者（进程）的信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import simpy</span><br><span class="line">def subfunc(env):</span><br><span class="line">    print(env.active_process)  # will print &quot;p1&quot;</span><br><span class="line"></span><br><span class="line">def my_proc(env):</span><br><span class="line">    while True:</span><br><span class="line">        print(env.active_process)  # will print &quot;p1&quot;</span><br><span class="line">        subfunc(env)</span><br><span class="line">        yield env.timeout(1)</span><br><span class="line"></span><br><span class="line">env = simpy.Environment()</span><br><span class="line">p1 = env.process(my_proc(env))</span><br><span class="line">print(env.active_process)</span><br><span class="line">env.step()</span><br><span class="line">print(env.active_process)</span><br><span class="line"></span><br><span class="line">None</span><br><span class="line">&lt;Process(my_proc) object at 0x183956c9278&gt;</span><br><span class="line">&lt;Process(my_proc) object at 0x183956c9278&gt;</span><br><span class="line">None</span><br></pre></td></tr></table></figure>
<p>An exemplary use case for this is the resource system: If a process function calls request() to request a resource, the resource determines the requesting process via env.active_process.</p>
</li>
<li><p>事件的创建<br>创建事件 normally 需要导入 <code>simpy.events</code>，实例化一个事件类，并传入一个对环境的引用。SimPy 也提供了一下快捷方式，例如 <code>env.event()</code> 等效于<code>simpy.events.Event(env)</code>。其他的快捷方式还有:</p>
<ol>
<li>env.process()</li>
<li>env.timeout()</li>
<li>env.all_of()</li>
<li>env.any_of()</li>
</ol>
</li>
<li><p>Miscellaneous<br>自从 Python 3.3 ，一个生成器函数可以有一个返回值。<br>在 SimPy 中，一个进程通过这种方式提供可以被其他进程使用的返回值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">def my_proc(env):</span><br><span class="line">    yield env.timeout(1)</span><br><span class="line">    return 42</span><br><span class="line">def other_proc(env):</span><br><span class="line">    ret_val = yield env.process(my_proc(env))</span><br><span class="line">    assert ret_val == 42</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h4><p>SimPy 的内建事件层次：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">events.Event</span><br><span class="line">|</span><br><span class="line">+— events.Timeout</span><br><span class="line">|</span><br><span class="line">+— events.Initialize</span><br><span class="line">|</span><br><span class="line">+— events.Process</span><br><span class="line">|</span><br><span class="line">+— events.Condition</span><br><span class="line">|  |</span><br><span class="line">|  +— events.AllOf</span><br><span class="line">|  |</span><br><span class="line">|  +— events.AnyOf</span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">.</span><br></pre></td></tr></table></figure>
<p>资源定义了额外的事件。这一部分的内容主要聚焦在 <code>simpy.events</code>模块中的事件。</p>
<ol>
<li><p>事件基础<br>SimPy 的事件和 deferreds、futures 或者 promises 十分类似。一个事件会处于下面状态中的一个：</p>
<ul>
<li>might happen (not triggered),</li>
<li>is going to happen (triggered) or</li>
<li>has happened (processed).</li>
</ul>
<p>事件会逐一按序经历上面的状态，事件和时间紧密结合，时间引起事件状态的更新。<br>初始的时候，事件没有被触发，它们仅仅是内存中的对象。<br>当一个事件触发，事件就会 insert into SimPy 的事件队列，事件的 <code>triggered</code> 属性变为 <code>True</code>。<br>As long as the event is not processed, you can add callbacks to an event. <strong>Callbacks are callables that accept an event as parameter and are stored in the Event.callbacks list</strong>.<br>An event becomes processed when SimPy pops it from the event queue and calls all of its callbacks. It is now no longer possible to add callbacks. The property Event.processed becomes True.<br>Events also have a value. The value can be set before or when the event is triggered and can be retrieved via Event.value or, within a process, by yielding the event (value = yield event).<br>事件被触发，就会加入事件队列，<code>triggered</code> 属性就会变为 <code>True</code>。<br>事件未被触发，就不会加入事件队列，<code>triggered</code> 属性就仍为 <code>False</code>。<br>一旦事件被加入队列，队列中的事件之间就会按序（创建次序，时间，优先级等）被调度处理。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> simpy</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_callback</span><span class="params">(event)</span>:</span></span><br><span class="line">    print(<span class="string">'Called back from'</span>, event)</span><br><span class="line"></span><br><span class="line">env = simpy.Environment()</span><br><span class="line">event = env.event()</span><br><span class="line">event.callbacks.append(my_callback)</span><br><span class="line">print(event.triggered)</span><br><span class="line">print(event.processed)</span><br><span class="line">env.run(event)</span><br><span class="line"></span><br><span class="line"><span class="literal">False</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>
<p>上面的代码会抛出运行时错误<code>RuntimeError: No scheduled events left but &quot;until&quot; event was not triggered: &lt;Event() object at 0x18e07e36c18&gt;</code>这是因为<code>env.event()</code>也就是<code>simpy.events.Event(env)</code>并不会触发自身，事件队列为空，因此会报错，env.timeout(1) 就会把自己加入事件列表，并在 now + 1 时被调度处理。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> simpy</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_callback</span><span class="params">(event)</span>:</span></span><br><span class="line">    print(<span class="string">'Called back from'</span>, event)</span><br><span class="line">env = simpy.Environment()</span><br><span class="line"><span class="comment"># event = env.event()</span></span><br><span class="line">event = env.timeout(<span class="number">1</span>)</span><br><span class="line">event.callbacks.append(my_callback)</span><br><span class="line"></span><br><span class="line">print(env.now)</span><br><span class="line">print(env._queue)</span><br><span class="line">print(event.triggered)</span><br><span class="line">print(event.processed)</span><br><span class="line">env.run(event)</span><br><span class="line">print(env.now)</span><br><span class="line">print(env._queue)</span><br><span class="line">print(event.triggered)</span><br><span class="line">print(event.processed)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">0</span></span><br><span class="line">[(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, &lt;Timeout(<span class="number">1</span>) object at <span class="number">0x2a67fa677f0</span>&gt;)]</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line">Called back <span class="keyword">from</span> &lt;Timeout(<span class="number">1</span>) object at <span class="number">0x2a67fa677f0</span>&gt;</span><br><span class="line"><span class="number">1</span></span><br><span class="line">[]</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Adding callbacks to an event<br>The most common way to add a callback to an event is yielding it from your process function (yield event). This will add the process’ _resume() method as a callback. That’s how your process gets resumed when it yielded an event.<br>However, you can add any callable object (function) to the list of callbacks as long as it accepts an event instance as its <strong>single</strong> parameter。<br>If an event has been processed, all of its Event.callbacks have been executed and the attribute is set to None. This is to prevent you from adding more callbacks。<br>Processes are smart about this, though. If you yield a processed event, _resume() will immediately resume your process with the value of the event (because there is nothing to wait for).也就是 _resume() 方法加不进事件的回调列表了。</p>
</li>
<li><p>Triggering events</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import simpy</span><br><span class="line">class School:</span><br><span class="line">    def __init__(self, env):</span><br><span class="line">        self.env = env</span><br><span class="line">        print(&quot;1: &quot;, self.env._queue)</span><br><span class="line">        self.class_ends = env.event()</span><br><span class="line">        print(&quot;2: &quot;, self.env._queue)</span><br><span class="line">        self.pupil_procs = [env.process(self.pupil()) for i in range(3)]</span><br><span class="line">        print(&quot;3: &quot;, self.env._queue)</span><br><span class="line">        self.bell_proc = env.process(self.bell())</span><br><span class="line">        print(&quot;4: &quot;, self.env._queue)</span><br><span class="line"></span><br><span class="line">    def bell(self):</span><br><span class="line">        for i in range(2):</span><br><span class="line">            print(&quot;5: &quot;, i, self.env._queue)</span><br><span class="line">            yield self.env.timeout(45)</span><br><span class="line">            print(&quot;6: &quot;, i, self.env._queue)</span><br><span class="line">            self.class_ends.succeed()</span><br><span class="line">            print(&quot;7: &quot;, i, self.env._queue)</span><br><span class="line">            self.class_ends = self.env.event()</span><br><span class="line">            print(&quot;8: &quot;, i, self.env._queue)</span><br><span class="line">            print(&quot;bell is ringing...&quot;)</span><br><span class="line"></span><br><span class="line">    def pupil(self):</span><br><span class="line">        for i in range(2):</span><br><span class="line">            print(&apos;ZaZa...ZaZa...&apos;, end=&apos;&apos;)</span><br><span class="line">            print(&quot;9: &quot;, i, self.env._queue)</span><br><span class="line">            yield self.class_ends</span><br><span class="line">            print(&quot;10: &quot;, i, self.env._queue)</span><br><span class="line"></span><br><span class="line">env = simpy.Environment()</span><br><span class="line">school = School(env)</span><br><span class="line">print(&quot;Before runing...&quot;, env._queue, &quot;\n&quot;)</span><br><span class="line">env.run()</span><br><span class="line">print(&quot;After runing...&quot;, env._queue)</span><br></pre></td></tr></table></figure>
<p>输出结果如下，逐一分析就可以看出，只有在有 yield 时才会发生执行流在协程之间的切换，env.event() 只有在显式地调用<code>.succeed()</code>方法时<strong>才会被触发，加入事件队列</strong> ，它在队列中的时间标签就是 <code>current simulation time</code>，也就是调用 <code>succeed()</code> 方法时的系统仿真时间。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">1:  []</span><br><span class="line">2:  []</span><br><span class="line">3:  [(0, 0, 0, &lt;Initialize() object at 0x1b74a129a58&gt;), (0, 0, 1, &lt;Initialize() object at 0x1b74a163e10&gt;), (0, 0, 2, &lt;Initialize() object at 0x1b74a170240&gt;)]</span><br><span class="line">4:  [(0, 0, 0, &lt;Initialize() object at 0x1b74a129a58&gt;), (0, 0, 1, &lt;Initialize() object at 0x1b74a163e10&gt;), (0, 0, 2, &lt;Initialize() object at 0x1b74a170240&gt;), (0, 0, 3, &lt;Initialize() object at 0x1b74a1706a0&gt;)]</span><br><span class="line"></span><br><span class="line">Before runing... [(0, 0, 0, &lt;Initialize() object at 0x1b74a129a58&gt;), (0, 0, 1, &lt;Initialize() object at 0x1b74a163e10&gt;), (0, 0, 2, &lt;Initialize() object at 0x1b74a170240&gt;), (0, 0, 3, &lt;Initialize() object at 0x1b74a1706a0&gt;)]</span><br><span class="line"></span><br><span class="line">ZaZa...ZaZa...9:  0 [(0, 0, 1, &lt;Initialize() object at 0x1b74a163e10&gt;), (0, 0, 3, &lt;Initialize() object at 0x1b74a1706a0&gt;), (0, 0, 2, &lt;Initialize() object at 0x1b74a170240&gt;)]</span><br><span class="line">ZaZa...ZaZa...9:  0 [(0, 0, 2, &lt;Initialize() object at 0x1b74a170240&gt;), (0, 0, 3, &lt;Initialize() object at 0x1b74a1706a0&gt;)]</span><br><span class="line">ZaZa...ZaZa...9:  0 [(0, 0, 3, &lt;Initialize() object at 0x1b74a1706a0&gt;)]</span><br><span class="line">5:  0 []</span><br><span class="line">6:  0 []</span><br><span class="line">7:  0 [(45, 1, 5, &lt;Event() object at 0x1b74a129f98&gt;)]</span><br><span class="line">8:  0 [(45, 1, 5, &lt;Event() object at 0x1b74a129f98&gt;)]</span><br><span class="line">bell is ringing...</span><br><span class="line">5:  1 [(45, 1, 5, &lt;Event() object at 0x1b74a129f98&gt;)]</span><br><span class="line">10:  0 [(90, 1, 6, &lt;Timeout(45) object at 0x1b74a1706d8&gt;)]</span><br><span class="line">ZaZa...ZaZa...9:  1 [(90, 1, 6, &lt;Timeout(45) object at 0x1b74a1706d8&gt;)]</span><br><span class="line">10:  0 [(90, 1, 6, &lt;Timeout(45) object at 0x1b74a1706d8&gt;)]</span><br><span class="line">ZaZa...ZaZa...9:  1 [(90, 1, 6, &lt;Timeout(45) object at 0x1b74a1706d8&gt;)]</span><br><span class="line">10:  0 [(90, 1, 6, &lt;Timeout(45) object at 0x1b74a1706d8&gt;)]</span><br><span class="line">ZaZa...ZaZa...9:  1 [(90, 1, 6, &lt;Timeout(45) object at 0x1b74a1706d8&gt;)]</span><br><span class="line">6:  1 []</span><br><span class="line">7:  1 [(90, 1, 7, &lt;Event() object at 0x1b74a1706a0&gt;)]</span><br><span class="line">8:  1 [(90, 1, 7, &lt;Event() object at 0x1b74a1706a0&gt;)]</span><br><span class="line">bell is ringing...</span><br><span class="line">10:  1 [(90, 1, 8, &lt;Process(bell) object at 0x1b74a170668&gt;)]</span><br><span class="line">10:  1 [(90, 1, 8, &lt;Process(bell) object at 0x1b74a170668&gt;), (90, 1, 9, &lt;Process(pupil) object at 0x1b74a129fd0&gt;)]</span><br><span class="line">10:  1 [(90, 1, 8, &lt;Process(bell) object at 0x1b74a170668&gt;), (90, 1, 9, &lt;Process(pupil) object at 0x1b74a129fd0&gt;), (90, 1, 10, &lt;Process(pupil) object at 0x1b74a163b00&gt;)]</span><br><span class="line">After runing... []</span><br><span class="line">[Finished in 0.2s]</span><br></pre></td></tr></table></figure>
<p>上面的倒数第二条打印可以看到只有两个 Process(pupil) 对象，这是为什么呢？这是因为我们有三个 pupil 进程，进程只有结束时才会在事件队列中加入一个结束事件，也就是说这里的两个 Process(pupil) 是由第三个进程打印的前两个进程，由于第三个进程并没有结束，因此尚未将自己的结束事件加入事件列表。</p>
</li>
<li><p>Let time pass by: the Timeout<br>To <strong>actually</strong> let time pass in a simulation, there is the timeout event. A timeout has two parameters: a delay and an optional value: Timeout(delay, value=None). It triggers itself during its creation and schedules itself at now + delay. Thus, the succeed() and fail() methods cannot be called again.</p>
</li>
<li><p>Processes are events, too<br>SimPy processes (as created by Process or env.process()) have the nice property of being events, too.<br>That means, that a process can yield another process. 将第一个进程的 _resume() 方法加入第二个进程（作为事件）的回调列表。<br>It will then be resumed when the other process ends. The event’s value will be the return value of that process:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">import simpy</span><br><span class="line"></span><br><span class="line">def sub(env):</span><br><span class="line">    print(&quot;sub 1: &quot;, env.active_process.__repr__())</span><br><span class="line">    print(&quot;sub 1: &quot;, env.active_process.triggered)</span><br><span class="line">    print(&quot;sub 1: &quot;, env.active_process.processed)</span><br><span class="line">    print(&quot;sub 1: &quot;, env._queue)</span><br><span class="line">    yield env.timeout(1)</span><br><span class="line">    print(&quot;sub 2: &quot;, env.active_process.triggered)</span><br><span class="line">    print(&quot;sub 2: &quot;, env.active_process.processed)</span><br><span class="line">    print(&quot;sub 2: &quot;, env._queue)</span><br><span class="line">    return 23</span><br><span class="line">def parent(env):</span><br><span class="line">    print(&quot;parent 1: &quot;, env.active_process.__repr__())</span><br><span class="line">    print(&quot;parent 1: &quot;, env.active_process.triggered)</span><br><span class="line">    print(&quot;parent 1: &quot;, env.active_process.processed)</span><br><span class="line">    print(&quot;parent 1: &quot;, env._queue)</span><br><span class="line">    sp = env.process(sub(env))</span><br><span class="line">    print(&quot;parent 2: &quot;, env._queue)</span><br><span class="line">    ret = yield sp</span><br><span class="line">    print(&quot;parent 3: &quot;, env._queue)</span><br><span class="line">    print(&quot;parent 2: &quot;, env.active_process.processed)</span><br><span class="line">    print(&quot;parent 2: &quot;, env.active_process.processed)</span><br><span class="line">    return ret</span><br><span class="line">env = simpy.Environment()</span><br><span class="line">pp = env.process(parent(env))</span><br><span class="line">print(&quot;main: &quot;, env._queue)</span><br><span class="line">print(env.run(pp))</span><br><span class="line">print(pp.triggered)</span><br><span class="line">print(pp.processed)</span><br><span class="line"></span><br><span class="line">main:  [(0, 0, 0, &lt;Initialize() object at 0x2b6ea6f98d0&gt;)]</span><br><span class="line">parent 1:  &lt;Process(parent) object at 0x2b6ea6f9898&gt;</span><br><span class="line">parent 1:  False</span><br><span class="line">parent 1:  False</span><br><span class="line">parent 1:  []</span><br><span class="line">parent 2:  [(0, 0, 1, &lt;Initialize() object at 0x2b6ea7339e8&gt;)]</span><br><span class="line">sub 1:  &lt;Process(sub) object at 0x2b6ea6f9e10&gt;</span><br><span class="line">sub 1:  False</span><br><span class="line">sub 1:  False</span><br><span class="line">sub 1:  []</span><br><span class="line">sub 2:  False</span><br><span class="line">sub 2:  False</span><br><span class="line">sub 2:  []</span><br><span class="line">parent 3:  []</span><br><span class="line">parent 2:  False</span><br><span class="line">parent 2:  False</span><br><span class="line">23</span><br><span class="line">True</span><br><span class="line">True</span><br><span class="line">[Finished in 0.2s]</span><br></pre></td></tr></table></figure>
<p><code>env.active_process.triggered</code> 和 <code>env.active_process.processed</code> 为什么总是返回 <code>False</code>, 从 <code>parent 1: &lt;Process(parent) object at 0x2b6ea6f9898&gt;</code> 和 <code>sub 1: &lt;Process(sub) object at 0x2b6ea6f9e10&gt;</code> 就可以看出来了，进程的 <code>triggered</code> 和 <code>processed</code> 只有在进程函数返回时才会被置为 <code>True</code>，因为进程作为事件标识的是结束事件。<br>The example above will only work in Python &gt;= 3.3. As a workaround for older Python versions, you can use env.exit(23) with the same effect.<br>If you don’t want a process to start immediately but after a certain delay, you can use simpy.util.start_delayed(). This method returns a helper <strong>process</strong> that uses a timeout before actually starting a process.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> simpy</span><br><span class="line">env = simpy.Environment()</span><br><span class="line"><span class="keyword">from</span> simpy.util <span class="keyword">import</span> start_delayed</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sub</span><span class="params">(env)</span>:</span></span><br><span class="line">    <span class="keyword">yield</span> env.timeout(<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">23</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parent</span><span class="params">(env)</span>:</span></span><br><span class="line">    start = env.now</span><br><span class="line">    print(<span class="string">"2: "</span>, env._queue)</span><br><span class="line">    sp = start_delayed(env, sub(env), delay=<span class="number">3</span>)</span><br><span class="line">    print(<span class="string">"3: "</span>, env._queue)</span><br><span class="line">    sub_proc = <span class="keyword">yield</span> sp</span><br><span class="line">    print(<span class="string">"4: "</span>, env._queue)</span><br><span class="line">    <span class="keyword">assert</span> env.now - start == <span class="number">3</span></span><br><span class="line">    ret = <span class="keyword">yield</span> sub_proc</span><br><span class="line">    print(<span class="string">"6: "</span>, env._queue)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line">pp = env.process(parent(env))</span><br><span class="line">print(<span class="string">"1: "</span>, env._queue)</span><br><span class="line">print(env.run(pp))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">1</span>:  [(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, &lt;Initialize() object at <span class="number">0x1d4ae1e7b70</span>&gt;)]</span><br><span class="line"><span class="number">2</span>:  []</span><br><span class="line"><span class="number">3</span>:  [(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, &lt;Initialize() object at <span class="number">0x1d4ae2302e8</span>&gt;)]</span><br><span class="line"><span class="number">4</span>:  [(<span class="number">13</span>, <span class="number">1</span>, <span class="number">5</span>, &lt;Timeout(<span class="number">10</span>) object at <span class="number">0x1d4ae1e7b70</span>&gt;)]</span><br><span class="line"><span class="number">6</span>:  []</span><br><span class="line"><span class="number">23</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Waiting for multiple events at once</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import simpy</span><br><span class="line">env = simpy.Environment()</span><br><span class="line">def test_condition(env):</span><br><span class="line">    t1, t2 = env.timeout(1, value=&apos;spam&apos;), env.timeout(2, value=&apos;eggs&apos;)</span><br><span class="line">    ret = yield t1 | t2</span><br><span class="line">    assert ret == &#123;t1: &apos;spam&apos;&#125;</span><br><span class="line">    t1, t2 = env.timeout(1, value=&apos;spam&apos;), env.timeout(2, value=&apos;eggs&apos;)</span><br><span class="line">    ret = yield t1 &amp; t2</span><br><span class="line">    assert ret == &#123;t1: &apos;spam&apos;, t2: &apos;eggs&apos;&#125;</span><br><span class="line">    # You can also concatenate &amp; and |</span><br><span class="line">    e1, e2, e3 = [env.timeout(i) for i in range(3)]</span><br><span class="line">    yield (e1 | e2) &amp; e3</span><br><span class="line">    assert all(e.processed for e in [e1, e2, e3])</span><br><span class="line"></span><br><span class="line">proc = env.process(test_condition(env))</span><br><span class="line">print(env._queue[0][-1].triggered)</span><br><span class="line">print(env._queue[0][-1].processed)</span><br><span class="line">print(proc.triggered)</span><br><span class="line">print(proc.processed)</span><br><span class="line">print(env.run())</span><br><span class="line"></span><br><span class="line">True</span><br><span class="line">False</span><br><span class="line">False</span><br><span class="line">False</span><br><span class="line">None</span><br><span class="line">[Finished in 0.2s]</span><br></pre></td></tr></table></figure>
</li>
</ol>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2017/11/13/Ubuntu-2-1080Ti-深度学习环境配置/" rel="prev" title="Ubuntu + 2*1080Ti 深度学习环境配置">
      <i class="fa fa-chevron-left"></i> Ubuntu + 2*1080Ti 深度学习环境配置
    </a></div>
      <div class="post-nav-item">
    <a href="/2017/11/20/Learning-Simpy-2/" rel="next" title="Learning Simpy 2">
      Learning Simpy 2 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#SimPy-基础"><span class="nav-number">1.</span> <span class="nav-text">SimPy 基础</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#How-SimPy-works"><span class="nav-number">1.1.</span> <span class="nav-text">How SimPy works</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#环境"><span class="nav-number">1.2.</span> <span class="nav-text">环境</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#事件"><span class="nav-number">1.3.</span> <span class="nav-text">事件</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Fengcun Li"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Fengcun Li</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">106</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Fengcun Li</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  











<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>




  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
